<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <meta name="description" content="" />
  <meta name="author" content="" />
  <title>TempFit - 날씨 기반 의상 추천</title>
  <link rel="icon" type="image/x-icon" href="assets/favicon.ico" />
  <link href="css/styles.css" rel="stylesheet" />
</head>
<body>
<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <div class="container px-5">
    <a class="navbar-brand" href="/">
      <img src="/assets/tempfit-logo.png" alt="TempFit" style="height: 38px" />
    </a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
        <li class="nav-item"><a class="nav-link active" aria-current="page" href="/community/list">게시글</a></li>
        <li class="nav-item"><a class="nav-link" href="#!">About</a></li>
        <li class="nav-item"><a class="nav-link" href="#!">Contact</a></li>
        <li class="nav-item"><a class="nav-link" href="#!">Services</a></li>
      </ul>
    </div>
  </div>
</nav>

<!-- Main Container -->
<div class="container px-4 px-lg-5">
  <div class="row gx-4 gx-lg-5 align-items-center my-5">
    <!-- 날씨 카드 -->
    <div class="col-lg-7">
      <div class="card shadow-sm mb-4" style="max-width: 460px; margin: auto">
        <div class="card-body text-center">
          <div id="weather-icon" style="font-size: 3rem; margin-bottom: 8px"></div>
          <div id="weather-sky" class="fw-bold" style="font-size: 1.1rem; color: #226be7">-</div>
          <div id="weather-desc" style="margin-bottom: 2px">-</div>
          <div id="weather-temp" style="font-size: 2.4rem; font-weight: bold; margin-bottom: 5px">-℃</div>
          <div class="text-secondary" id="weather-date">-</div>
          <div class="text-secondary" id="weather-time">-</div>
          <div id="weather-location" class="mt-2"></div>
        </div>
      </div>
    </div>
    <!-- 추천 코디 -->
    <div class="col-lg-5">
      <h1 class="font-weight-light" id="clothing-guide-head">오늘의 추천 코디</h1>
      <div id="weather-area" class="mb-4">
      </div>
      <div id="clothing-guide" style="display: flex; gap: 24px; margin-bottom: 24px"></div>
    </div>
  </div>

  <!-- Call to Action Card -->
  <div class="card text-white bg-secondary my-5 py-4 text-center">
    <div class="card-body">
      <p class="text-white m-0">
        시간대별 온도
      </p>
    </div>
  </div>

  <!-- Content Row -->
  <div class="row gx-4 gx-lg-5">
    <div class="col-md-4 mb-5">
      <div class="card h-100">
        <div class="card-body">
          <h2 class="card-title">Card One</h2>
          <p class="card-text">
            Lorem ipsum dolor sit amet, consectetur adipisicing elit. Rem magni quas ex numquam, maxime minus quam
            molestias corporis quod, ea minima accusamus.
          </p>
        </div>
        <div class="card-footer"><a class="btn btn-primary btn-sm" href="#!">More Info</a></div>
      </div>
    </div>
    <div class="col-md-4 mb-5">
      <div class="card h-100">
        <div class="card-body">
          <h2 class="card-title">Card Two</h2>
          <p class="card-text">
            Lorem ipsum dolor sit amet, consectetur adipisicing elit. Quod tenetur ex natus at dolorem enim!
            Nesciunt pariatur voluptatem sunt quam eaque, vel, non in id dolore voluptates quos eligendi labore.
          </p>
        </div>
        <div class="card-footer"><a class="btn btn-primary btn-sm" href="#!">More Info</a></div>
      </div>
    </div>
    <div class="col-md-4 mb-5">
      <div class="card h-100">
        <div class="card-body">
          <h2 class="card-title">Card Three</h2>
          <p class="card-text">
            Lorem ipsum dolor sit amet, consectetur adipisicing elit. Rem magni quas ex numquam, maxime minus quam
            molestias corporis quod, ea minima accusamus.
          </p>
        </div>
        <div class="card-footer"><a class="btn btn-primary btn-sm" href="#!">More Info</a></div>
      </div>
    </div>
  </div>
</div>
<!-- Footer-->
<footer class="py-5 bg-dark">
  <div class="container px-4 px-lg-5">
    <p class="m-0 text-center text-white">Copyright &copy; TempFit 2025</p>
  </div>
</footer>
<!-- Bootstrap core JS-->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="js/scripts.js"></script>
<!-- 위치 + 날씨 + 추천 JS -->
<script>
window.addEventListener('DOMContentLoaded', function() {
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(
      function(pos) {
        const lat = pos.coords.latitude;
        const lon = pos.coords.longitude;
        fetch(`/api/weather/current?lat=${lat}&lon=${lon}`)
          .then(res => res.json())
          .then(data => {
            let tempNum = parseInt(data.temp);
            // 날씨 상세 표시 (좌측)
            document.getElementById('weather-sky').textContent = data.sky || '-';
            document.getElementById('weather-desc').textContent = data.rainType || '-';
            document.getElementById('weather-temp').textContent = (data.temp !== undefined ? data.temp : '-');
            document.getElementById('weather-date').textContent = data.fcstDate || '-';
            document.getElementById('weather-time').textContent = data.fcstTime || '-';
            // 옷 추천
            fetch(`/api/coordi/guide?temp=${tempNum}`)
              .then(res => res.json())
              .then(renderGuide)
              .catch(() => {
                document.getElementById("clothing-guide").innerText = "추천 코디 정보를 가져오지 못했습니다";
              });
          })
          .catch(() => {
            document.getElementById('weather-info').innerText = '날씨 정보를 가져오지 못했습니다.';
          });
      },
      function(error) {
        document.getElementById('weather-info').innerText = '위치 권한을 허용해 주세요!';
      }
    );
  } else {
    document.getElementById('weather-info').innerText = '브라우저가 위치정보를 지원하지 않습니다.';
  }

  // 옷 추천 렌더 함수(기존거 활용)
function renderGuide(data) {
  // 예: data = { top: {name: "...", imageUrl: "..."}, ... }
  const guideDiv = document.getElementById("clothing-guide");
  guideDiv.innerHTML = "";
  for (const [part, info] of Object.entries(data)) {
    guideDiv.innerHTML += `
      <div style="text-align:center;">
        <img src="${info.imageUrl}" alt="${info.name}" width="100" height="100"
          style="border-radius:10px; border:1px solid #ddd; background:#fafafa;"/><br/>
        <b>${part === "top" ? "상의" : part === "bottom" ? "하의" : "신발"}</b><br/>
        <span style="font-size:18px;">${info.name}</span>
      </div>
    `;
    }
  }
});
</script>
</body>
</html>
